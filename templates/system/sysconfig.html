{% extends "system/base.html" %}

{% load static %}

{% block title %}系统配置{% endblock %}

{% block css %}
<link href="{% static  "system/css/sysconfig.css" %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="alert alert-danger " role="alert" id="myalter" style="display: none">
        <button type="button" class="close" id="close" >
          <span aria-hidden="true">&times;</span>
        </button>
      <strong id="tips" >IP地址不合法</strong>
    </div>
    <div class="row sparse"><label class="head">录音配置&nbsp&nbsp&nbsp&nbsp</label></div>

    <div class="row tips">
        <label>音频配置</label>
    </div>
    <form method="post">
        <div class="row1 row" id="selebox">
            <div class="col-md-6">
                {{ form.audiotype.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ form.audiotype}}
            </div>
            <div class="col-md-6" id="audioTime">
                <span>{{ form.audiotime.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.audiotime}}&nbsp;&nbsp;&nbsp;分钟</span>
            </div>
        </div>
        <div class="row1 row" id="inputpath">
            <div class="col-md-4" id="filepath">
                {{ form.path.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ form.path}}
            </div>
            <div class="col-md-8" id="scanbtn">
                <a class="btn btn-primary" id="scan"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;浏览</a>
            </div>
        </div>
        <div class="hidden">{{ form.usrname_n}}</div>
        <div class="hidden">{{ form.usr_perssions_n}}</div>
        <div class="row">
            <div class="col-md-2 col-md-offset-10">
                <input type="submit" value="保存并重启" id="save" class="btn btn-primary">
            </div>
        </div>
    </form>
    <div class="row tips">
        <label>通道信息及配置</label>
    </div>

    <div id="table_box">
         <table class="table table-hover table-condensed table-striped" id="configed_table">
            <colgroup>
                <col style="width: 40px"><col style="width: 20%"><col style="width: 20%"><col style="width: 70px"><col style="width: 20%">
            </colgroup>
            <thead>
                <tr>
                    <th>通道号</th>
                    <th>通道名</th>
                    <th>录音模式</th>
                    <th>配置</th>
                    <th>配置提示</th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="configed_table_body">
        <table class="table table-hover table-condensed table-striped" id="table_body">
            <colgroup>
                <col style="width: 40px"><col style="width: 20%"><col style="width: 20%"><col style="width: 70px"><col style="width: 20%">
            </colgroup>
            <tbody>
            {% for channel in channels %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{channel.0}}</td>
                    <td>{{channel.1}}</td>
                    <td class="config">
                        <a class="btn config" href="/system/channelconfig.html?no={{ forloop.counter }}&name={{ name }}&permiss={{ permiss }}">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td><span class="glyphicon glyphicon-exclamation-sign savetip" aria-hidden="true" id="save{{ forloop.counter }}" style="display: none">&nbsp;配置尚未生效</span></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>


{% endblock %}

{% block js %}
<script type="text/javascript">
    $('a#flow').attr('aria-expanded','true');
    $('div#collapseExample').attr('class','collapse in');
    $('input#id_usrname_n').val("{{ name }}")
    $('input#id_usr_perssions_n').val("{{ permiss }}")
    $('input#id_path').val("{{ filepath }}")

    {% for channel in channels %}
        if ('{{channel.2}}'=='false'){
            $('span#save{{ forloop.counter }}').attr('style','display:inline')
        } else {
            $('span#save{{ forloop.counter }}').attr('style','display:none')
        }
    {% endfor %}

    $('button#close').click(function () {
        $('#myalter').attr('style','display:none')
    });

    if('{{ method }}'=='get') {
        $('select#id_audiotype').val('{{audiotype}}');
        $('input#id_audiotime').val('{{audiotime}}')
    } else {
        if('{{ res }}'=='failed') {
            $('#tips').html('设置失败');
            $('#myalter').attr('class','alert alert-danger');
            $('#myalter').attr('style','display:block')
        } else if('{{ res }}'=='online') {
            $('#tips').html('无法执行设置操作，请先关闭所有录音通道');
            $('#myalter').attr('class','alert alert-danger');
            $('#myalter').attr('style','display:block')
        } else {
            $('#tips').html('设置成功，服务器需要30秒左右重启生效');
            $('#myalter').attr('class','alert alert-success');
            $('#myalter').attr('style','display:block');
            $('span.savetip').attr('style','display:none');
        }
    }


$('a#scan').click(function () {
    try {
        var Message = "\u8bf7\u9009\u62e9\u6587\u4ef6\u5939"; //选择框提示信息
        var Shell = new ActiveXObject("Shell.Application");
        //var Folder = Shell.BrowseForFolder(0, Message, 64, 17); //起始目录为：我的电脑
        var Folder = Shell.BrowseForFolder(0, Message, 0); //起始目录为：桌面
        if (Folder != null) {
            Folder = Folder.items(); // 返回 FolderItems 对象
            Folder = Folder.item(); // 返回 Folderitem 对象
            Folder = Folder.Path; // 返回路径
            if (Folder.charAt(Folder.length - 1) != "\\") {
                Folder = Folder + "\\";
            }
            document.getElementById('id_path').value = Folder;
            return Folder;
        }
    }
    catch (e) {
        alert(e.message);
    }

})


</script>
{% endblock %}



