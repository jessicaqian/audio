{% extends "system/base.html" %}

{% load static %}

{% block title %}系统配置{% endblock %}

{% block css %}
<link href="{% static  "system/css/sysconfig.css" %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="alert alert-danger " role="alert" id="myalter" style="display: none">
        <button type="button" class="close" id="close" >
          <span aria-hidden="true">&times;</span>
        </button>
      <strong id="tips" >IP地址不合法</strong>
    </div>
    <div class="row sparse"><label class="head">录音配置&nbsp&nbsp&nbsp&nbsp</label></div>


    <div class="row tips">
        <label>音频配置</label>
    </div>
    <form method="post">
        <div class="row1 row" id="selebox">
            <div class="col-md-4">
                {{ form.audiotype.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ form.audiotype}}
            </div>
            <div class="col-md-4" id="filepath">
                {{ form.path.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ form.path}}
            </div>
            <div class="col-md-4" id="scanbtn">
                <a class="btn btn-primary" id="scan"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;浏览</a>
            </div>
        </div>

        <div class="hidden">{{ form.usrname_n}}</div>
        <div class="hidden">{{ form.usr_perssions_n}}</div>
        <div class="row">
            <div class="col-md-2 col-md-offset-10">
                <input type="submit" value="保&nbsp&nbsp存" id="save" class="btn btn-primary">
            </div>
        </div>
    </form>
    <div class="row tips">
        <label>通道信息及配置</label>
    </div>

    <div class="row sparse" id="head_bar">
        <div class="col-md-3">
            <label>通道列表</label>

        </div>

        <div class="col-md-9"></div>
    </div>

    <div id="table_box">
         <table class="table table-hover table-condensed table-striped" id="configed_table">
            <colgroup>
                <col style="width: 40px"><col style="width: 30%"><col style="width: 25%"><col style="width: 70px">
            </colgroup>
            <thead>
                <tr>
                    <th>#</th>
                    <th>通道号</th>
                    <th>通道名</th>
                    <th>配置</th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="configed_table_body">
        <table class="table table-hover table-condensed table-striped" id="table_body">
            <colgroup>
                <col style="width: 40px"><col style="width: 30%"><col style="width: 25%"><col style="width: 70px">
            </colgroup>
            <tbody>

            {% for channel in channels %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>channel{{ forloop.counter }}</td>
                    <td>{{channel}}</td>
                    <td class="config">
                        <a class="btn config" href="/system/channelconfig.html?no={{ forloop.counter }}&name={{ name }}&permiss={{ permiss }}">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                        </a>
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>

    </div>







{% endblock %}

{% block js %}
<script type="text/javascript">
    $('a#flow').attr('aria-expanded','true');
    $('div#collapseExample').attr('class','collapse in');
    $('input#id_usrname_n').val("{{ name }}")
    $('input#id_usr_perssions_n').val("{{ permiss }}")

    $('button#close').click(function () {
        $('#myalter').attr('style','display:none')
    });

    if('{{ method }}'=='get')
        $('input#id_path').val("{{ filepath }}")
        $('select#id_audiotype').val('{{audiotype}}')

    }else {
        if('{{ res }}'=='failed'){
            $('#tips').html('设置失败')
            $('#myalter').attr('class','alert alert-danger')
            $('#myalter').attr('style','display:block')
        }else {
            $('#tips').html('保存成功')
            $('#myalter').attr('class','alert alert-success')
            $('#myalter').attr('style','display:block')

        }
    }


$('a#scan').click(function () {
    try {
        var Message = "\u8bf7\u9009\u62e9\u6587\u4ef6\u5939"; //选择框提示信息
        var Shell = new ActiveXObject("Shell.Application");
        //var Folder = Shell.BrowseForFolder(0, Message, 64, 17); //起始目录为：我的电脑
        var Folder = Shell.BrowseForFolder(0, Message, 0); //起始目录为：桌面
        if (Folder != null) {
            Folder = Folder.items(); // 返回 FolderItems 对象
            Folder = Folder.item(); // 返回 Folderitem 对象
            Folder = Folder.Path; // 返回路径
            if (Folder.charAt(Folder.length - 1) != "\\") {
                Folder = Folder + "\\";
            }
            document.getElementById('id_path').value = Folder;
            return Folder;
        }
    }
    catch (e) {
        alert(e.message);
    }

})


</script>
{% endblock %}

