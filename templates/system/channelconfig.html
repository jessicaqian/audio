{% extends "system/base.html" %}

{% load static %}

{% block title %}系统配置{% endblock %}

{% block css %}
<link href="{% static  "system/css/channelconfig.css" %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="alert alert-danger " role="alert" id="myalter" style="display: none">
        <button type="button" class="close" id="close" >
          <span aria-hidden="true">&times;</span>
        </button>
      <strong id="tips" >录音阈值或录音时长格式错误</strong>，该值只能为正整数，请重新输入。
    </div>
    <div class="alert alert-danger " role="alert" id="myalter1" style="display: none">
        <button type="button" class="close" id="close1" >
          <span aria-hidden="true">&times;</span>
        </button>
      <strong id="tips1" ></strong>
    </div>


    <div class="row sparse"><label class="head">录音配置&nbsp&nbsp&nbsp&nbsp</label></div>
    <div class="row tips">
        <label>通道配置</label>
        <span class="glyphicon glyphicon-exclamation-sign savetip" aria-hidden="true" style="display: none"></span>
        <span class="sr-only">Error:</span>
        <span style="display: none" class="savetip">该通道配置尚未生效</span>
    </div>
    <form method="post" onsubmit="return checknum()">
        <div class="row1 row selebox">
            <div class="col-md-4">
                {{ form.channelNo.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;channel{{ form.channelNo}}
            </div>
        </div>
        <div class="row1 row selebox">
            <div class="col-md-6">
                {{ form.channelname.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.channelname}}
            </div>
            <div class="col-md-6">
                {{ form.audiomode.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.audiomode}}
            </div>

        </div>
        <div class="row1 row selebox">
            <div class="col-md-6" id="recordval">
                {{ form.recordval.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.recordval}}db
            </div>
            <div class="col-md-6" id="mutetime">
                {{ form.mutetime.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.mutetime}}秒
            </div>
        </div>
        <div class="row1 row selebox">
            <div class="col-md-6" id="main_comment">
                {{ form.main_comment.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.main_comment }}
            </div>
            <div class="col-md-6" id="sub_comment">
                {{ form.sub_comment.label_tag}}&nbsp;&nbsp;&nbsp;&nbsp;{{ form.sub_comment }}
            </div>
        </div>
        <div class="hidden">{{ form.usrname_n}}</div>
        <div class="hidden">{{ form.usr_perssions_n}}</div>
        <div class="hidden">{{ form.saveconfig }}</div>
        <div class="hidden">{{ form.goback }}</div>
        <div class="row">
            <div class="col-md-1 col-md-offset-8">
                <a id="reset" class="btn btn-primary" href="">还原配置</a>
            </div>
            <div class="col-md-1">
                <input type="submit" value="保存配置" id="save" class="btn btn-primary">
            </div>
            <div class="col-md-1">
                <input type="submit" value="返回主页面" id="goback" class="btn btn-warning">
            </div>
        </div>
    </form>


{% endblock %}

{% block js %}
<script type="text/javascript">
$('a#flow').attr('aria-expanded','true');
$('div#collapseExample').attr('class','collapse in');
$('input#id_usrname_n').val("{{ name }}");
$('input#id_usr_perssions_n').val("{{ permiss }}");

if('{{ method }}'=='get'){
    $('input#id_channelNo').val("{{ channelno }}");
    $('input#id_channelname').val("{{ channelname }}");
    $('select#id_audiomode').val('{{audiomode}}');
    $('input#id_recordval').val("{{ recordval }}");
    $('input#id_mutetime').val("{{ mutetime }}");
    $('input#id_main_comment').val("{{ main_comment }}");
    $('input#id_sub_comment').val("{{ sub_comment }}");

    if('{{ save }}'=='false'){
        $('span.savetip').attr('style','display:inline')
    }else {
        $('span.savetip').attr('style','display:none')
    }
} else {
    if('{{ res }}'=='online'){
        $('#tips1').html('无法执行设置操作，请先关闭所有录音通道')
        $('#myalter1').attr('class','alert alert-danger')
        $('#myalter1').attr('style','display:block')
    }else if('{{ res }}'=='failed'){
        $('#tips1').html('设置失败')
        $('#myalter1').attr('class','alert alert-danger')
        $('#myalter1').attr('style','display:block')
    }else if('{{ res }}'=='same'){
        $('#tips1').html('参数未发生改变')
        $('#myalter1').attr('class','alert alert-danger')
        $('#myalter1').attr('style','display:block')
    }
}

checkmode()


$('button#close').click(function () {
    $('#myalter').attr('style','display:none')
});

$('button#close1').click(function () {
    $('#myalter1').attr('style','display:none')
});

$('input#goback').click(function () {
    $('input#id_goback').val('true')
});

$('input#save').click(function () {
    $('input#id_saveconfig').val('false')
});

$('select#id_audiomode').change(function () {
    checkmode()
})

$('a#reset').click(function () {
    var no = $('input#id_channelNo').val()
    $.get('channelconfig.html?no=' + no + '&name={{name}}&permiss={{permiss}}&reset=true').done(function (info) {

    }).fail(function () {

    })
})

function checknum() {
    var val = $('input#id_recordval').val();
    var time = $('input#id_mutetime').val();
    if ((/(^[1-9]\d*$)/.test(val))&&(/(^[1-9]\d*$)/.test(time))) {
        return true
    }else {
        $('#myalter').attr('style','display:block');
        return false　　　　　　
    }
}

function checkmode() {
    var audiomode = $('select#id_audiomode').val();
    if(audiomode == "全时段录音"){
        $('div#mutetime').attr('style','display:none')
    }else{
        $('div#mutetime').attr('style','display:block')
    }
}


</script>
{% endblock %}